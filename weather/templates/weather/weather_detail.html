{% extends 'base.html' %}

{% block title %}Météo {{ city }} - Détails{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'weather:home' %}">Accueil</a></li>
                    <li class="breadcrumb-item active" aria-current="page">{{ city }}</li>
                </ol>
            </nav>
        </div>
    </div>

    {% if current_weather %}
    <div class="row mb-5">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h2>{{ current_weather.city }}, {{ current_weather.country }}</h2>
                    <p class="mb-0">{{ current_weather.datetime|date:"l d F Y, H:i" }}</p>
                </div>
                <div class="card-body">
                    <div class="d-flex align-items-center mb-4">
                        <img src="https://openweathermap.org/img/wn/{{ current_weather.icon }}@4x.png" alt="{{ current_weather.description }}" class="me-3" width="100">
                        <div>
                            <h1 class="display-4">{{ current_weather.temperature }}°C</h1>
                            <h4>{{ current_weather.description|capfirst }}</h4>
                            <p>Ressenti: {{ current_weather.feels_like }}°C</p>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-6">
                            <p><strong>Humidité:</strong> {{ current_weather.humidity }}%</p>
                            <p><strong>Pression:</strong> {{ current_weather.pressure }} hPa</p>
                        </div>
                        <div class="col-6">
                            <p><strong>Vent:</strong> {{ current_weather.wind_speed }} km/h</p>
                            <p><strong>Nuages:</strong> {{ current_weather.clouds }}%</p>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-6">
                            <p><strong>Lever du soleil:</strong> {{ current_weather.sunrise_time|time:"H:i" }}</p>
                        </div>
                        <div class="col-6">
                            <p><strong>Coucher du soleil:</strong> {{ current_weather.sunset_time|time:"H:i" }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h3>Alertes météo</h3>
                </div>
                <div class="card-body">
                    <h4>Alertes API</h4>
                    {% if api_alerts %}
                        {% for alert in api_alerts %}
                            <div class="alert alert-warning">
                                <h5>{{ alert.event }}</h5>
                                <p>{{ alert.description }}</p>
                                <small>
                                    Du {{ alert.start_time|date:"d/m/Y H:i" }} 
                                    au {{ alert.end_time|date:"d/m/Y H:i" }}
                                </small>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted">Aucune alerte météo API en cours pour cette région.</p>
                    {% endif %}
                    
                    <h4 class="mt-4">Alertes base de données</h4>
                    {% if db_alerts %}
                        {% for alert in db_alerts %}
                            <div class="alert alert-info">
                                <h5>{{ alert.fk_type.label }}</h5>
                                <p>{{ alert.description }}</p>
                                <small>Date: {{ alert.date_alert|date:"d/m/Y" }}</small>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted">Aucune alerte en base de données pour cette région.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-12">
            <h3>Prévisions sur 5 jours</h3>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Heure</th>
                            <th>Température</th>
                            <th>Conditions</th>
                            <th>Vent</th>
                            <th>Humidité</th>
                            <th>Précipitations</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in forecast %}
                            <tr>
                                <td>{{ item.datetime|date:"d/m/Y" }}</td>
                                <td>{{ item.datetime|time:"H:i" }}</td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <img src="https://openweathermap.org/img/wn/{{ item.icon }}.png" alt="{{ item.description }}" class="me-2">
                                        {{ item.temperature }}°C
                                    </div>
                                </td>
                                <td>{{ item.description }}</td>
                                <td>{{ item.wind_speed }} km/h</td>
                                <td>{{ item.humidity }}%</td>
                                <td>
                                    {% if item.rain > 0 %}
                                        Pluie: {{ item.rain }} mm
                                    {% elif item.snow > 0 %}
                                        Neige: {{ item.snow }} mm
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% else %}
    <div class="row">
        <div class="col-12">
            <div class="alert alert-warning">
                <h4>Données météo non disponibles</h4>
                <p>Impossible de récupérer les données météo pour {{ city }}. Veuillez réessayer ultérieurement.</p>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %} 