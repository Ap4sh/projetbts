{% extends 'base.html' %}

{% block title %}Météo {{ city }} - Détails{% endblock title %}

{% block content %}
<div class="container mx-auto px-4 py-6">
    <!-- En-tête avec le nom de la ville et les données principales -->
    <div class="flex flex-col md:flex-row items-center justify-between mb-8 bg-base-200 p-6 rounded-box shadow-md">
        <div class="flex items-center gap-4">
            <div class="weather-icon">
                <img src="https://openweathermap.org/img/wn/{{ current_weather.weather.icon }}@4x.png" 
                     alt="{{ current_weather.weather.description }}" 
                     class="w-24 h-24" />
            </div>
            <div>
                <h1 class="text-3xl font-bold">{{ city }}</h1>
                <p class="text-xl">{{ current_weather.weather.description|capfirst }}</p>
                <div class="flex items-baseline gap-2">
                    <span class="text-4xl font-bold">{{ current_weather.main.temp|floatformat:0 }}°C</span>
                    <span class="text-sm opacity-70">
                        Ressenti: {{ current_weather.main.feels_like|floatformat:0 }}°C
                    </span>
                </div>
            </div>
        </div>
        
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4 md:mt-0">
            <div class="stat-box p-3 bg-base-100 rounded-box">
                <div class="text-sm opacity-70">Humidité</div>
                <div class="text-xl font-semibold">{{ current_weather.main.humidity }}%</div>
            </div>
            <div class="stat-box p-3 bg-base-100 rounded-box">
                <div class="text-sm opacity-70">Vent</div>
                <div class="text-xl font-semibold">{{ current_weather.wind.speed }} km/h</div>
            </div>
            <div class="stat-box p-3 bg-base-100 rounded-box">
                <div class="text-sm opacity-70">Pression</div>
                <div class="text-xl font-semibold">{{ current_weather.main.pressure }} hPa</div>
            </div>
            <div class="stat-box p-3 bg-base-100 rounded-box">
                <div class="text-sm opacity-70">Visibilité</div>
                <div class="text-xl font-semibold">{{ current_weather.visibility|floatformat:0 }} m</div>
            </div>
            <div class="stat-box p-3 bg-base-100 rounded-box">
                <div class="text-sm opacity-70">Lever du soleil</div>
                <div class="text-xl font-semibold">{{ current_weather.sys.sunrise|date:"H:i" }}</div>
            </div>
            <div class="stat-box p-3 bg-base-100 rounded-box">
                <div class="text-sm opacity-70">Coucher du soleil</div>
                <div class="text-xl font-semibold">{{ current_weather.sys.sunset|date:"H:i" }}</div>
            </div>
        </div>
    </div>
    
    <!-- Prévisions pour les prochains jours -->
    <div class="mb-8">
        <h2 class="text-2xl font-bold mb-4">Prévisions sur 5 jours</h2>
        {% include 'weather/partials/forecast_table.html' with forecast=forecast %}
    </div>
    
    <!-- Alertes météo pour cette région -->
    <div class="mb-8">
        <h2 class="text-2xl font-bold mb-4">Alertes météo</h2>
        
        {% if api_alerts or db_alerts %}
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                {% for alert in api_alerts %}
                <div class="alert {% if alert.severity == 'red' %}alert-error{% elif alert.severity == 'orange' %}alert-warning{% else %}alert-info{% endif %}">
                    <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                    <div>
                        <h3 class="font-bold">{{ alert.event }}</h3>
                        <div class="text-sm">{{ alert.start|date:"j F H:i" }} - {{ alert.end|date:"j F H:i" }}</div>
                        <div class="text-xs mt-1">{{ alert.description }}</div>
                    </div>
                </div>
                {% endfor %}
                
                {% for alert in db_alerts %}
                <div class="alert {% if alert.severity == 'red' %}alert-error{% elif alert.severity == 'orange' %}alert-warning{% else %}alert-info{% endif %}">
                    <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                    <div>
                        <h3 class="font-bold">Alerte {{ alert.fk_type.label }}</h3>
                        <div class="text-sm">{{ alert.region }} - {{ alert.date_alert|date:"j F Y" }}</div>
                        <div class="text-xs mt-1">{{ alert.description }}</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="alert alert-info">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span>Aucune alerte météo en cours pour cette région.</span>
            </div>
        {% endif %}
    </div>
    
    <!-- Carte de localisation -->
    <div>
        <h2 class="text-2xl font-bold mb-4">Localisation</h2>
        <div class="h-[300px] bg-base-200 rounded-box">
            {% if current_weather.coordinates %}
            <iframe
                width="100%"
                height="100%"
                frameborder="0"
                scrolling="no"
                marginheight="0"
                marginwidth="0"
                src="https://www.openstreetmap.org/export/embed.html?bbox={{ current_weather.coordinates.lon|add:'-0.1' }}%2C{{ current_weather.coordinates.lat|add:'-0.1' }}%2C{{ current_weather.coordinates.lon|add:'0.1' }}%2C{{ current_weather.coordinates.lat|add:'0.1' }}&amp;layer=mapnik&amp;marker={{ current_weather.coordinates.lat }}%2C{{ current_weather.coordinates.lon }}"
                class="rounded-box"
            ></iframe>
            {% else %}
            <div class="flex items-center justify-center h-full">
                <p>Carte non disponible</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock content %} 